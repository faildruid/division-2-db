# We can't remove volumes in a compose override, for the test configuration using the final containers
# we don't want the volumes so this is the default override file to add the volumes in the dev case
# any override will need to include these volumes to use them.
# see:  https://github.com/docker/compose/issues/3729
---
version: "3.4"
services:
  api:
    ports:
      - "8080:8080"
    volumes:
      - "../:/source"
    healthcheck:
      start_period: 180s
      timeout: 3s
      interval: 15s
      test: "curl -f http://api:8080/api/docs/ || exit 1"
    depends_on:
      db:
        condition: "service_healthy"
      wd:
        condition: "service_started"
  docs:
    entrypoint: "mkdocs serve -v -a 0.0.0.0:8080"
    ports:
      - "8001:8080"
    volumes:
      - "../docs:/source/docs:ro"
      - "../mkdocs.yml:/source/mkdocs.yml:ro"
    image: "division:py${PYTHON_VER}"
    container_name: "docs"
    hostname: "docs"
    healthcheck:
      disable: true
    tty: true
    depends_on:
      api:
        condition: "service_healthy"

  db:
    ports:
      - "5432"
  spa:
    ports:
    - "8081:3000"
    depends_on:
      api:
        condition: "service_healthy"